generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DB_URL")
}

// ENUMS
enum Role {
    USER
    ADMIN
    MODERATOR
    GUEST
    SUPER_ADMIN
}

enum Status {
    ACTIVE
    INACTIVE
    PENDING
    SUSPENDED
}

enum VerificationStatus {
    PENDING
    VERIFIED
    REJECTED
}

enum VerificationType {
    ACCOUNT_VERIFICATION
    PASSWORD_RESET
}

enum LoginAttemptStatus {
    SUCCESS
    FAILURE
}

enum AuthStatus {
    LOGGED_IN
    LOGGED_OUT
}

model User {
    id                      String                    @id @default(cuid())
    firstName               String?
    lastName                String?
    email                   String                    @unique
    phone                   String?                   @unique
    password                String
    role                    Role                      @default(USER)
    status                  Status                    @default(INACTIVE)
    createdAt               DateTime                  @default(now())
    updatedAt               DateTime                  @updatedAt
    authHistory             AuthHistory[]
    AuthVerificationHistory AuthVerificationHistory[]
}

model AuthHistory {
    id            String             @id @default(cuid())
    userId        String
    user          User               @relation(fields: [userId], references: [id])
    authStatus    AuthStatus         @default(LOGGED_IN)
    attemptStatus LoginAttemptStatus @default(SUCCESS)
    ip            String
    device        String
    createdAt     DateTime           @default(now())
}

model AuthVerificationHistory {
    id               String           @id @default(cuid())
    userId           String
    verificationType VerificationType @default(ACCOUNT_VERIFICATION)
    verificationCode String
    issuedAt         DateTime         @default(now())
    expiredAt        DateTime
    verifiedAt       DateTime?
    user             User             @relation(fields: [userId], references: [id])
}
